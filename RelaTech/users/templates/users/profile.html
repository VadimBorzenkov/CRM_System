{% extends 'deals/base.html' %}
{% load static %}

{% block css %}
<link href="{% static 'vendor/css/profile.css' %}" rel="stylesheet">
{% endblock %}

{% block navigation %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="{% url 'index'%}">Главная</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
            aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

    </div>
</nav>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-7">
            <h4 class="mt-3 mb-3">Профиль</h4>
            <div class="col-lg-12 text-center">
                <img width="100" height="100"
                    src="{% if user.image %} {{ user.image.url }} {% else %} {% static 'vendor\img\users\default_avatar.jpg' %} {% endif %}"
                    class="img-thumbnail">
            </div>
            <form action="{% url 'users:profile' user.id %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-row">
                    <div class="col-lg-6">
                        <div class="form-group">
                            <label class="small mb-1" for="{{ form.first_name.id_for_label }}">Имя</label>
                            {{ form.first_name }}
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="form-group">
                            <label class="small mb-1" for="{{ form.last_name.id_for_label }}">Фамилия</label>
                            {{ form.last_name }}
                        </div>
                    </div>
                </div>
                <div class="form-row mb-2">
                    <div class="col-lg-12">
                        <div class="custom-file">
                            {{ form.image }}
                            <label class="custom-file-label" for="{{ form.image.id_for_label }}">Выберите
                                изображение</label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-lg-6">
                        <label class="small mb-1" for="{{ form.username.id_for_label }}">Имя пользователя</label>
                        {{ form.username }}
                    </div>
                    <div class="col-lg-6">
                        <label class="small mb-1" for="{{ form.email.id_for_label }}">Адрес электронной
                            почты</label>
                        {{ form.email }}
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-lg-12" style="margin-top: 33px;">
                        <input class="btn btn-info btn-block" type="submit" value="Сохранить">
                    </div>
                </div>
            </form>

            {% if user.user_type == 'admin' %}
            <!-- Для админа -->
            <div class="mt-4">
                <a class="dropdown-item" href="{% url 'customers:customers' %}">Все клиенты</a>
                <a class="dropdown-item" href="{% url 'deals:deals' %}">Все сделки</a>
            </div>
            {% elif user.user_type == 'company' %}
            <div class="mt-4">
                <h4>Продукты вашей компании</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Название продукта</th>
                            <th>Описание</th>
                            <th>Цена</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in company_products %}
                        <tr>
                            <td>{{ product.name }}</td>
                            <td>{{ product.description }}</td>
                            <td>{{ product.price }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="mt-4">
                <h4>Сделки</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Название продукта</th>
                            <th>Количество</th>
                            <th>Общая сумма</th>
                            <th>Дата сделки</th>
                            <th>Клиент</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for deal in user_deals %}

                        <tr>
                            <td>{{ deal.product }}</td>
                            <td>{{ deal.quantity }}</td>
                            <td>{{ deal.total_amount }}</td>
                            <td>{{ deal.deal_date }}</td>
                            <td>{{ deal.customer }}</td>
                            <td>{{ deal.get_status_display }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>


            {% else %}
            <!-- Для обычного пользователя -->
            <div class="mt-4">
                <h4>Ваши сделки</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Название продукта</th>
                            <th>Количество</th>
                            <th>Общая сумма</th>
                            <th>Дата сделки</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for deal in user_deals %}
                        <tr>
                            <td>{{ deal.product }}</td>
                            <td>{{ deal.quantity }}</td>
                            <td>{{ deal.total_amount }}</td>
                            <td>{{ deal.deal_date }}</td>
                            <td>{{ deal.get_status_display }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}

        </div>

    </div>
</div>
{% endblock %}